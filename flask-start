#!/bin/bash
# Simple Flask + Pipenv Auto-Starter

echo "ğŸš€ Flask Development Environment Starting..."

# Install dependencies if needed
if [ ! -f "Pipfile.lock" ] || [ "Pipfile" -nt "Pipfile.lock" ]; then
    echo "ğŸ“¦ Installing dependencies..."
    pipenv install
fi

# Start Flask in background
echo "ğŸ”¥ Starting Flask server..."
cd server && python app.py &
FLASK_PID=$!
cd ..

echo "âœ… Flask started with PID: $FLASK_PID"
echo "ğŸŒ Flask running on http://127.0.0.1:5555"
echo "ğŸ’¡ Routes: / (main) and /<username> (profiles)"
echo ""

# Setup cleanup function
cleanup() {
    echo ""
    echo "ğŸ›‘ Stopping Flask server..."
    kill $FLASK_PID 2>/dev/null
    wait $FLASK_PID 2>/dev/null
    echo "âœ… Development environment stopped!"
}

# Set trap for cleanup
trap cleanup EXIT

echo "ğŸ’¡ Starting pipenv shell..."
exec pipenv shell
